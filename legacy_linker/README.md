# LegacyLinker - VB6 遺留系統分析與 Wiki 生成器

**LegacyLinker** 是一個專為分析古老且龐大的 Visual Basic 6.0 (VB6) 專案群而設計的工具。它能自動掃描程式碼庫，解析專案結構 (.vbp)，識別跨系統的呼叫關係 (Shell/Exe)，並生成一個現代化、可搜尋且包含關聯圖表的 Wiki 網站。

---

## 🚀 功能特色

*   **自動化專案盤點**：遞迴掃描目錄，自動識別所有 `.vbp` 專案檔。
*   **深層依賴分析**：
    *   解析程式碼 (`.frm`, `.bas`) 中的 `Shell()` 指令與字串常數。
    *   自動建立「專案 A」呼叫「專案 B」的關聯圖。
    *   克服 VB6 路徑寫死或動態組裝的分析困難（透過 `.exe` 關鍵字啟發式搜尋）。
*   **現代化文件生成**：
    *   基於 **MkDocs** 與 **Material for MkDocs** 主題。
    *   自動生成互動式 **Mermaid** 流程圖。
    *   支援全站即時搜尋。

---

## 🛠️ 環境需求

在開始之前，請確保您的系統已安裝以下工具：

1.  **Java JDK 17** 或更高版本。
2.  **Maven** (用於建置 Java 專案)。
3.  **Python 3.x** (用於執行 MkDocs)。

---

## 📦 安裝與建置

### 1. 下載專案
```bash
git clone <repository-url>
cd legacy_linker
```

### 2. 編譯 Java 工具
使用 Maven 進行編譯與依賴下載：
```bash
mvn clean compile
```

### 3. 準備 Python 環境 (Wiki 引擎)
為了避免汙染系統環境，建議使用虛擬環境安裝 MkDocs：

```bash
# 建立虛擬環境
# Windows:
python -m venv venv
# Mac/Linux:
python3 -m venv venv

# 啟動虛擬環境
# Windows (Command Prompt):
venv\Scripts\activate.bat
# Windows (PowerShell):
venv\Scripts\Activate.ps1
# Mac/Linux:
source venv/bin/activate

# 安裝必要套件
pip install mkdocs mkdocs-material
```

---

## 💻 使用指南

### 基本指令
執行以下指令來掃描您的 VB6 原始碼目錄：

```bash
# 格式
mvn exec:java -Dexec.args="<VB6原始碼路徑> -o <輸出目錄>"

# 範例 (掃描上層的 sample_data/photodemon 目錄)
mvn exec:java -Dexec.args="../sample_data/photodemon -o wiki_output"
```

參數說明：
*   **第 1 個參數**：VB6 原始碼的根目錄 (支援相對或絕對路徑)。
*   **-o / --output**：(選填) Wiki 檔案的輸出目錄，預設為 `wiki_output`。

### 預覽 Wiki
生成完成後，啟動本地伺服器進行瀏覽：

```bash
# 確保您在虛擬環境中 (若尚未啟動請執行 source venv/bin/activate)
cd wiki_output
mkdocs serve
```

瀏覽器打開 **http://127.0.0.1:8000** 即可看到結果。

---

## 🔍 技術細節：連結器邏輯 (Linker Logic)

LegacyLinker 使用「啟發式掃描」來建立專案與執行檔之間的關聯，特別是針對許多非標準寫法的 VB6 專案：

1.  **建立查找表**：首先掃描所有 `.vbp` 檔，建立 `ExeName32` (編譯目標) 到 `ProjectName` 的對照表。
    *   *例如：找到 `Inv.exe` 是由 `Inventory.vbp` 編譯而來。*
2.  **特徵提取**：掃描所有程式碼 (`.frm`, `.bas`)。
    *   不僅尋找標準的 `Shell("path")`。
    *   更搜尋所有**包含 `.exe` 的字串常數**。這能有效抓到如 `Process.Start("Inv.exe")` 或自製 Wrapper 函數的呼叫。
3.  **路徑標準化**：自動處理 Windows 風格的反斜線路徑 (`\`)，確保在 Mac/Linux 系統上也能正確定位檔案。

---

## ❓ 常見問題

**Q: 掃描出的關聯圖包含很多 "Unknown" 的節點？**
A: 這代表程式碼呼叫了外部工具 (如 `notepad.exe`, `calc.exe`)，或者該 `.exe` 的原始碼 `.vbp` 不在您掃描的目錄範圍內。

**Q: 中文註解會亂碼嗎？**
A: 工具預設使用 `ISO-8859-1` (西歐) 或 `Big5/GBK` 相容的讀取策略來處理舊檔案，並嘗試轉換為 UTF-8 輸出到 Markdown。若遇到特定編碼問題，請回報給開發團隊。

---

_Generated by **LegacyLinker** Team_
